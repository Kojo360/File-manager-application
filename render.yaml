services:
  - type: web
    name: file-manager-app
    env: python
    plan: free
    region: oregon
    buildCommand: |
      echo "ğŸš€ Starting enhanced build process..."
      
      # Install system dependencies with proper error handling
      echo "ğŸ“¦ Updating package manager..."
      apt-get update || echo "Package update failed, continuing..."
      
      echo "ğŸ“¦ Installing OCR system dependencies..."
      apt-get install -y tesseract-ocr tesseract-ocr-eng poppler-utils || echo "System packages failed, trying alternatives..."
      
      # Verify installations
      echo "ğŸ” Verifying installations..."
      tesseract --version || echo "âš ï¸ Tesseract not found"
      pdftoppm -h >/dev/null 2>&1 && echo "âœ… Poppler installed" || echo "âš ï¸ Poppler not found"
      
      # Python dependencies
      echo "ğŸ“¦ Installing Python dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt
      
      # Django setup
      echo "ğŸ“‚ Collecting static files..."
      python manage.py collectstatic --no-input --clear
      
      echo "ğŸ—„ï¸ Running migrations..."
      python manage.py migrate --noinput
      
      echo "âœ… Build completed successfully!"
    startCommand: "gunicorn backend.wsgi:application"
    autoDeploy: true
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: false
      - key: WEB_CONCURRENCY
        value: 2
