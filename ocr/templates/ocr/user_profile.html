{% extends 'ocr/base.html' %}

{% block title %}User Profile - File Manager{% endblock %}

{% block page_title %}User Profile{% endblock %}
{% block page_subtitle %}Manage your account settings and preferences{% endblock %}

{% block content %}
<div class="profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="avatar-section">
      <div class="avatar-large">
        <i class="fas fa-user"></i>
      </div>
      <button class="avatar-edit-btn">
        <i class="fas fa-camera"></i>
      </button>
    </div>
    
    <div class="profile-info">
      <h2>{{ user.get_full_name|default:user.username }}</h2>
      <p class="user-email">{{ user.email|default:"No email set" }}</p>
      <div class="user-stats">
        <div class="stat-item">
          <span class="stat-value">{{ user_stats.total_files|default:0 }}</span>
          <span class="stat-label">Files Processed</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ user_stats.success_rate|default:0 }}%</span>
          <span class="stat-label">Success Rate</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ user_stats.days_active|default:0 }}</span>
          <span class="stat-label">Days Active</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Management Tabs -->
  <div class="profile-tabs">
    <div class="tab-navigation">
      <button class="tab-btn active" onclick="switchTab('account')">
        <i class="fas fa-user-cog"></i>
        Account Settings
      </button>
      <button class="tab-btn" onclick="switchTab('security')">
        <i class="fas fa-shield-alt"></i>
        Security
      </button>
    </div>

    <!-- Account Settings Tab -->
    <div class="tab-content active" id="account-tab">
      <div class="settings-section">
        <h3>
          <i class="fas fa-user-edit"></i>
          Personal Information
        </h3>
        
        <form class="settings-form" method="post" action="{% url 'ocr:update_profile' %}">
          {% csrf_token %}
          <div class="form-row">
            <div class="form-group">
              <label for="first_name">First Name</label>
              <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" class="form-control">
            </div>
            <div class="form-group">
              <label for="last_name">Last Name</label>
              <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" class="form-control">
            </div>
          </div>
          
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" value="{{ user.email }}" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" value="{{ user.username }}" class="form-control" readonly>
            <small class="form-help">Username cannot be changed</small>
          </div>
          
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i>
            Save Changes
          </button>
        </form>
      </div>
    </div>
              <option value="grid">Grid View</option>
              <option value="list" selected>List View</option>
              <option value="detail">Detail View</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="files_per_page">Files Per Page</label>
            <select id="files_per_page" class="form-control">
              <option value="10">10 files</option>
              <option value="20" selected>20 files</option>
              <option value="50">50 files</option>
              <option value="100">100 files</option>
            </select>
          </div>
          
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i>
            Save Preferences
          </button>
        </form>
      </div>
    </div>

    <!-- Security Tab -->
    <div class="tab-content" id="security-tab">
      <div class="settings-section">
        <h3>
          <i class="fas fa-lock"></i>
          Change Password
        </h3>
        
        <form class="settings-form" method="post" action="{% url 'ocr:change_password' %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="current_password">Current Password</label>
            <input type="password" id="current_password" name="current_password" class="form-control" required>
          </div>
          
          <div class="form-group">
            <label for="new_password1">New Password</label>
            <input type="password" id="new_password1" name="new_password1" class="form-control" required>
          </div>
          
          <div class="form-group">
            <label for="new_password2">Confirm New Password</label>
            <input type="password" id="new_password2" name="new_password2" class="form-control" required>
          </div>
          
          <button type="submit" class="btn-primary">
            <i class="fas fa-key"></i>
            Update Password
          </button>
        </form>
      </div>
      
      <div class="settings-section">
        <h3>
          <i class="fas fa-users-cog"></i>
          Account Security
        </h3>
        
        <div class="security-options">
          <div class="security-item">
            <div class="security-info">
              <h4>Two-Factor Authentication</h4>
              <p>Add an extra layer of security to your account</p>
            </div>
            <button class="btn-outline-primary">Enable 2FA</button>
          </div>
          
          <div class="security-item">
            <div class="security-info">
              <h4>Active Sessions</h4>
              <p>Manage devices logged into your account</p>
            </div>
            <button class="btn-outline-secondary">View Sessions</button>
          </div>
          
          <div class="security-item">
            <div class="security-info">
              <h4>Download Your Data</h4>
              <p>Export all your processed files and data</p>
            </div>
            <button class="btn-outline-info">Download Data</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications Tab -->
    <div class="tab-content" id="notifications-tab">
      <div class="settings-section">
        <h3>
          <i class="fas fa-bell-slash"></i>
          Notification Preferences
        </h3>
        
        <form class="settings-form">
          <div class="notification-category">
            <h4>Processing Notifications</h4>
            
            <div class="preference-group">
              <label class="preference-label">
                <input type="checkbox" class="preference-checkbox" checked>
                <span class="checkbox-custom"></span>
                <span class="preference-text">File processing completed</span>
                <small class="preference-description">Notify when OCR processing finishes</small>
              </label>
            </div>
            
            <div class="preference-group">
              <label class="preference-label">
                <input type="checkbox" class="preference-checkbox">
                <span class="checkbox-custom"></span>
                <span class="preference-text">Processing failures</span>
                <small class="preference-description">Alert when file processing fails</small>
              </label>
            </div>
          </div>
          
          <div class="notification-category">
            <h4>System Notifications</h4>
            
            <div class="preference-group">
              <label class="preference-label">
                <input type="checkbox" class="preference-checkbox" checked>
                <span class="checkbox-custom"></span>
                <span class="preference-text">System maintenance</span>
                <small class="preference-description">Notify about scheduled maintenance</small>
              </label>
            </div>
            
            <div class="preference-group">
              <label class="preference-label">
                <input type="checkbox" class="preference-checkbox">
                <span class="checkbox-custom"></span>
                <span class="preference-text">Feature updates</span>
                <small class="preference-description">Information about new features</small>
              </label>
            </div>
          </div>
          
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i>
            Save Notification Settings
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.profile-container {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

/* Profile Header */
.profile-header {
  background: rgba(51, 65, 85, 0.9);
  backdrop-filter: blur(25px);
  border: 1px solid rgba(148, 163, 184, 0.2);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 30px;
}

.avatar-section {
  position: relative;
}

.avatar-large {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  color: white;
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
}

.avatar-edit-btn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(59, 130, 246, 0.9);
  border: 2px solid rgba(51, 65, 85, 0.9);
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.avatar-edit-btn:hover {
  background: #2563eb;
  transform: scale(1.1);
}

.profile-info h2 {
  color: white;
  font-size: 28px;
  margin: 0 0 8px 0;
}

.user-email {
  color: rgba(255, 255, 255, 0.7);
  font-size: 16px;
  margin: 0 0 20px 0;
}

.user-stats {
  display: flex;
  gap: 30px;
}

.stat-item {
  text-align: center;
}

.stat-value {
  display: block;
  color: #3b82f6;
  font-size: 24px;
  font-weight: 700;
  line-height: 1;
}

.stat-label {
  color: rgba(255, 255, 255, 0.7);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Profile Tabs */
.profile-tabs {
  background: rgba(51, 65, 85, 0.9);
  backdrop-filter: blur(25px);
  border: 1px solid rgba(148, 163, 184, 0.2);
  border-radius: 20px;
  overflow: hidden;
}

.tab-navigation {
  display: flex;
  background: rgba(15, 23, 42, 0.4);
  border-bottom: 1px solid rgba(148, 163, 184, 0.2);
}

.tab-btn {
  flex: 1;
  padding: 20px;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 500;
}

.tab-btn:hover {
  background: rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.9);
}

.tab-btn.active {
  background: rgba(59, 130, 246, 0.1);
  color: #3b82f6;
  border-bottom: 2px solid #3b82f6;
}

.tab-content {
  display: none;
  padding: 30px;
}

.tab-content.active {
  display: block;
}

/* Settings Sections */
.settings-section {
  margin-bottom: 40px;
}

.settings-section:last-child {
  margin-bottom: 0;
}

.settings-section h3 {
  color: white;
  font-size: 20px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group label {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  font-weight: 500;
}

.form-control {
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid rgba(148, 163, 184, 0.2);
  border-radius: 8px;
  padding: 12px 16px;
  color: white;
  font-size: 14px;
  transition: all 0.3s ease;
}

.form-control:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-control:read-only {
  background: rgba(15, 23, 42, 0.3);
  color: rgba(255, 255, 255, 0.6);
}

.form-help {
  color: rgba(255, 255, 255, 0.5);
  font-size: 12px;
}

/* Preferences */
.preference-group {
  margin-bottom: 20px;
}

.preference-label {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  cursor: pointer;
  color: white;
}

.preference-checkbox {
  display: none;
}

.checkbox-custom {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(148, 163, 184, 0.3);
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
  position: relative;
  flex-shrink: 0;
  margin-top: 2px;
}

.preference-checkbox:checked + .checkbox-custom {
  background: #3b82f6;
  border-color: #3b82f6;
}

.preference-checkbox:checked + .checkbox-custom::after {
  content: '';
  position: absolute;
  left: 5px;
  top: 2px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.preference-text {
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.preference-description {
  display: block;
  color: rgba(255, 255, 255, 0.6);
  font-size: 12px;
  line-height: 1.4;
}

.notification-category {
  margin-bottom: 30px;
}

.notification-category h4 {
  color: rgba(255, 255, 255, 0.9);
  font-size: 16px;
  margin-bottom: 15px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.2);
}

/* Security */
.security-options {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.security-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background: rgba(15, 23, 42, 0.4);
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.1);
}

.security-info h4 {
  color: white;
  font-size: 16px;
  margin: 0 0 4px 0;
}

.security-info p {
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
  margin: 0;
}

/* Buttons */
.btn-primary,
.btn-outline-primary,
.btn-outline-secondary,
.btn-outline-info {
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: #3b82f6;
  border: 1px solid #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
  border-color: #2563eb;
}

.btn-outline-primary {
  background: transparent;
  border: 1px solid #3b82f6;
  color: #3b82f6;
}

.btn-outline-primary:hover {
  background: rgba(59, 130, 246, 0.1);
}

.btn-outline-secondary {
  background: transparent;
  border: 1px solid rgba(148, 163, 184, 0.5);
  color: rgba(255, 255, 255, 0.8);
}

.btn-outline-secondary:hover {
  background: rgba(148, 163, 184, 0.1);
  color: white;
}

.btn-outline-info {
  background: transparent;
  border: 1px solid #22c55e;
  color: #22c55e;
}

.btn-outline-info:hover {
  background: rgba(34, 197, 94, 0.1);
}

/* Responsive Design */
@media (max-width: 768px) {
  .profile-container {
    padding: 15px;
  }
  
  .profile-header {
    flex-direction: column;
    text-align: center;
    gap: 20px;
  }
  
  .user-stats {
    justify-content: center;
  }
  
  .tab-navigation {
    flex-direction: column;
  }
  
  .tab-btn {
    justify-content: flex-start;
    padding: 15px 20px;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .security-item {
    flex-direction: column;
    align-items: stretch;
    gap: 15px;
  }
}
</style>

<script>
// Tab switching functionality
function switchTab(tabName) {
  // Remove active class from all tabs and buttons
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  // Add active class to clicked button and corresponding content
  event.target.classList.add('active');
  document.getElementById(tabName + '-tab').classList.add('active');
}

// Form submission handlers
document.addEventListener('DOMContentLoaded', function() {
  // Handle preference form submissions
  const forms = document.querySelectorAll('.settings-form');
  
  forms.forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Show success message
      showToast('Settings saved successfully!', 'success');
    });
  });
  
  // Handle checkbox changes
  const checkboxes = document.querySelectorAll('.preference-checkbox');
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      // Auto-save preference
      showToast('Preference updated', 'info');
    });
  });
});

// Toast notification function
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.textContent = message;
  
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 2000;
    animation: slideIn 0.3s ease;
  `;
  
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => document.body.removeChild(toast), 300);
  }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
`;
document.head.appendChild(style);
</script>
{% endblock %}
